\section*{Optimization Equation}

The optimization problem will seek to minimize the distance between the centre of the camera footprint and the path that is to be observed. To achieve this the path will be optimized by minimizing the path error distance with regard to both the current position and the path up ahead. The states in the optimization problem is the UAV states and inputs. The optimization vector only consists of UAV states.

The states of the UAV $\mathbf{x}$ and inputs $\mathbf{u}$ are defined as

\begin{equation}
	\mathbf{x} = 
	\begin{bmatrix}
		p_n 	\\ p_e		\\ p_d	\\
		u 		\\ v   		\\ w 	\\ 
		\phi	\\ \theta	\\ \psi	\\
		p		\\ q		\\ r
	\end{bmatrix}, \hspace{5pt}
	\mathbf{u} = 
	\begin{bmatrix}
		\delta_e\\ \delta_a	\\ \delta_r	\\ \delta_t
	\end{bmatrix}.
\end{equation}

For each point $i$ on the parametrized ground path that is to be observed, the UAV states for the current point and the states for the future points that are included needs to be a part of the optimization vector. Therefore, for each timestep there is an optimization vector $\mathbf{z}_i$ that consists of $k$ UAV state vectors, with $k$ being the number of future points to include:

\begin{equation}
	\mathbf{z}_i =
	\begin{bmatrix}
		\mathbf{x}_{i,0} \hspace{6pt} \mathbf{x}_{i,1} \hspace{6pt} \mathbf{x}_{i,2} \hspace{6pt} \hdots \hspace{6pt} \mathbf{x}_{i,k}
	\end{bmatrix}^T.
\end{equation}

The final optimization vector $\mathbf{z}$ consists of the optimization vector for each of the points on the path:

\begin{equation}
	\mathbf{z} = 
	\begin{bmatrix}
		\mathbf{z}_0 \hspace{6pt} \mathbf{z}_1 \hspace{6pt} \mathbf{z}_2 \hspace{6pt} \hdots \hspace{6pt} \mathbf{z}_i
	\end{bmatrix}^T.
\end{equation}


\subsection*{Problem Definition}

\begin{equation}
	\begin{array}{rrclcl}
		\displaystyle \min_{\mathbf{z}} & \multicolumn{3}{l}{\bm{\Phi} = \sum\limits_{i=0}^k e_i} \\
		\textrm{s.t}
		%& \mathbf{A} \mathbf{z} & \leq & \mathbf{b} \\
		& \mathbf{z}^{low} \leq & \mathbf{z}_i & \leq \mathbf{z}^{high} \\
		& \mathbf{u}^{low} \leq & \mathbf{u}_i & \leq \mathbf{u}^{high} \\
		& \displaystyle \mathbf{z}_{i+1} & = & \mathbf{A}_d \mathbf{z}_i + \mathbf{B}_d \mathbf{u}_i
		%& \displaystyle \mathbf{\dot{z}} & = & f(\mathbf{z},\mathbf{u}) \\
	\end{array}
\end{equation}

where the inequality constraints represent the limits put on both the UAV states and inputs, and the equaltiy constraints represent the discrete model of the UAV. $e_i$ is the cross-track error from the current camera centre point to the path.


\subsubsection*{Cost Function}

The objective of the cost function is to minimize the cross track error $e$ between the path and the centre of the camera footprint of the UAVs current and future position. The position of the camera centre is expressed as $(c_x^n, c_y^n)$, calculated by:

\begin{equation}
\begin{split}
	\mathbf{c}^n & = \mathbf{p} + \mathbf{c}_b^b \\
	& =
	\begin{bmatrix}
		p_n \\ p_e
	\end{bmatrix}
	+ \mathbf{R}_{z,\psi}
	\begin{bmatrix}
		p_d tan(\theta) \\ p_d tan(\phi)
	\end{bmatrix}.
\end{split}
\end{equation}

The parametrized path will be expressed by a path variable $t$ so that points on the path that is to be observed $\mathbf{c}_d^n$ can be written as $(x_d(t), y_d(t), z_d(t))$. $z_d$ represents the aircraft altitude, and not the position of the path that is to be observed. The cross-track error $e_i$ can be written as

\begin{equation}
	e_i = ||\mathbf{c}_d^n - \mathbf{c}^n||
\end{equation}