\section*{Optimization Equation}

The optimization problem will seek to minimize the distance between the centre of the camera footprint and the path that is to be observed. To achieve this the path will be optimized by minimizing the path error distance with regard to both the current position and the path up ahead. The states in the optimization problem is the UAV states and inputs. The optimization vector only consists of UAV states.

The states of the UAV $\mathbf{x}$ and inputs $\mathbf{u}$ are defined as

\begin{equation}
	\mathbf{x} = 
	\begin{bmatrix}
		p_n 	\\ p_e		\\ p_d	\\
		u 		\\ v   		\\ w 	\\ 
		\phi	\\ \theta	\\ \psi	\\
		p		\\ q		\\ r
	\end{bmatrix}, \hspace{5pt}
	\mathbf{u} = 
	\begin{bmatrix}
		\delta_e \\ \delta_a	\\ \delta_r	\\ \delta_t
	\end{bmatrix}.
\end{equation}

The length of the optimization is given by $K$ timesteps. The optimization vector $\mathbf{z}$ will consist of UAV states $\mathbf{x}_i$ and inputs $\mathbf{u}_i$ for each of the $K$ timesteps. $\mathbf{x}_0$ and $\mathbf{u}_0$ equals the trimmed straight level flight of the UAV.

\begin{equation}
	\mathbf{z} =
	\begin{bmatrix}
		\mathbf{x}_1 \hspace{6pt} \mathbf{x}_2 \hspace{6pt} \hdots \hspace{6pt} \mathbf{x}_K \hspace{6pt} \mathbf{u}_1 \hspace{6pt} \mathbf{u}_2 \hspace{6pt} \hdots \hspace{6pt} \mathbf{u}_K
	\end{bmatrix}^T.
\end{equation}


\subsection*{Problem Definition}

\begin{equation}
	\begin{array}{rrclcl}
		\displaystyle \min_{\mathbf{z}} & \multicolumn{3}{l}{J_k = \frac{1}{2} \sum\limits_{i=k}^{k+L} [\mathbf{e}(\mathbf{z}_i)^\intercal \mathbf{Q} \mathbf{e}(\mathbf{z}_i)] + \frac{1}{2} \sum\limits_{i=k}^{k+L} [\mathbf{u}_i^\intercal \mathbf{R} \mathbf{u}_i]}\\
		\textrm{s.t}
		& \mathbf{x}^{low} \leq & \mathbf{x}_i & \leq \mathbf{x}^{high} \\
		& \mathbf{u}^{low} \leq & \mathbf{u}_i & \leq \mathbf{u}^{high} \\
		& \displaystyle \mathbf{x}_{k+1} & = & \mathbf{A}_d \mathbf{x}_k + \mathbf{B}_d \mathbf{u}_k
	\end{array}
\end{equation}

where the inequality constraints represent the limits put on both the UAV states and inputs, and the equaltiy constraints represent the discrete model of the UAV. The prediction horizon will include $L$ timesteps.


\subsubsection*{Cost Function}

The objective of the cost function is to minimize the cross track error $e$ between the path and the centre of the camera footprint of the UAVs current and future position. The position of the camera centre is expressed as $(c_x^n, c_y^n)$, calculated by:

\begin{equation}
\begin{split}
	\mathbf{c}^n & = \mathbf{p} + \mathbf{c}_b^b \\
	& =
	\begin{bmatrix}
		p_n \\ p_e
	\end{bmatrix}
	+ \mathbf{R}_{z,\psi}
	\begin{bmatrix}
		p_d tan(\theta) \\ p_d tan(\phi)
	\end{bmatrix}.
\end{split}
\end{equation}

The parametrized path will be expressed by a path variable $t$ so that points on the path that is to be observed $\mathbf{c}_d^n$ can be written as $(x_d(t), y_d(t), z_d(t))$. $z_d$ represents the aircraft altitude, and not the position of the path that is to be observed. The cross-track error $e_i$ can be written as

\begin{equation}
\begin{split}
	\mathbf{e}(\mathbf{z}_i) & = ||\mathbf{c}^n - \mathbf{c}^n_d|| \\
	& = \sqrt{(c_x^n - x_d)^2 + (c_y^n - y_d)^2}
\end{split}
\end{equation}