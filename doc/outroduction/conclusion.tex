\chapter{Conclusion}

The goal of this thesis was to develop a control method that would enable a UAV equipped with a hyperspectral camera fixed to its body to optimally survey a ground path. This was solved by creating an offline intervalwise MPC that seeks to minimize the distance between the camera point on the ground and the ground path that is to be observed. The MPC algorithm was implemented using C++ and the ACADO Toolkit.

The results show that the optimization method can be used to achieve good tracking of the ground path. SITL simulations show that even for a simple path, the mean error when tracking a path can be cut in half when tracking the optimal path compared to tracking the ground path. In addition to reduced error, tracking the optimized path results in less movement of the camera footprint, causing less movement in the captured images. The MPC is able to optimize both curved and piecewise linear paths, with piecewise linear paths giving the most precise end result during SITL simulations.

Even though the piecewise linear paths resulted in the most precise tracking, the MPC had a hard time optimizing piecewise linear paths. The sharpest linear corner it could optimize was a $45\degree$ turn. For curved turns it managed to optimize $90\degree$ turns with a radius of $50$m, and it can optimize $180\degree$ turns with a radius equal to or larger than $200$m. Long, straight paths connecting turns turned out to be a difficult for the MPC to solve. This was because the MPC do not correct the UAV position to be straight above the path during these stretches, which caused the aircraft to be in a unfortunate state when it encounters the next turn.

Testing showed that the optimization problem was a difficult and time consuming problem to solve. The application created in this thesis was not very robust, and it was especially vulnerable to how precise the ground path was given. Testing show that there is most likely an improvement to gain by reducing the stepsize of the MPC from $0.2$s to $0.1$s however, since the application was so time consuming, it was not thoroughly tested in this thesis.

%There was a big difference in how well the MPC handles piecewise linear and curved paths. The MPC manages to optimize curved $90\degree$ turns with a radius as low as $50$m. It is also able to optimize $180\degree$ turns, as long as the radius is $200$m or longer. When optimizing piecewise linear paths however, the MPC struggled a lot more. It managed to optimize linear $45\degree$ corners, but not $70\degree$ corners. This is most likely due to the fact that they are corners, and don't give the same smooth change in reference as curved paths do.

%When simulating the optimized paths in the simulator, the optimized paths for the piecewise linear paths turned out to be better than the curved paths. Both kinds shows great improvement from tracking the ground path itself.

\section{Future Work}

One of the major shortcomings of the MPC developed in this thesis is how the trajectory is generated for each iteration of the MPC. The method currently used is not precise enough, which leads to spikes in the reference used to solve the optimization problem. If the trajectory generation is improved it would hopefully remove many of the oscillations seen in these results, and make it possible to optimize even sharper corners. A more sophisticated trajectory generator could also allow the MPC to support loitering above a point.

Another problem area for the MPC that should be improved is the duration it takes to optimize the paths. Even though this application isn't intended to run in realtime, it uses what should be an unnecessary amount of time. The ACADO Toolkit offers a code-generation tool, that generates C++ code to be run instead of re-compiling the optimization problem for every iteration of the MPC. Using the code-generation tool may improve the time consumption.

Since the MPC already uses a linear model of the UAV, the cost function could be linearized in order to get a problem that takes less time to solve. Since the ACADO Toolkit is not optimal for linear problems, the linearized problem should be implemented with a different toolkit intended for solving linear problems.

In order to achieve more precise optimization, the complete nonlinear model of the UAV should be implemented. It was attempted in this thesis, but as it proved to be far from trivial to achieve stable trimmed flight with the nonlinear model, the linearized model was used instead. With the complete nonlinear model it would be possible to include wind in the optimization problem.