\section{MPC}

The task of the MPC part of the implementation is to supply the ACADO implementation with the information needed to perform the optimization, and also control the optimization algorithm so that the correct horizon is calculated, as well as storing the results in the correct order. The pseudocode for the MPC implementation is shown in algorithm \ref{alg:mpc} and \ref{alg:genHor}.

\begin{algorithm}
\caption{Offline Intervalwise MPC Algorithm}
\label{alg:mpc}
\begin{algorithmic}
\Procedure{MPC}{}
	\State $\textit{path} \gets \text{path from file}$
	\State $\textit{timestep} \gets \text{duration of timestep}$
	\State $\textit{horizonlen} \gets \text{number of } \textit{timestep} \text{ in horizon}$
	\State $\textit{intervallen} \gets \text{number of } \textit{timestep} \text{ in interval}$
	\State $\textit{no intervals} \gets \text{number of } \textit{interval} \text{ needed to cover } \textit{path}$
	\State $\textit{x0} \gets \text{initial values of differential states}$
	\State $\textit{u0} \gets \text{initial values of control states}$
	\State $\textit{du0} \gets \text{inital values of control rates}$
	\For{each \textit{no intervals}}
		\State $\textit{horizon} \gets \Call{GenerateHorizon}{path, timestep, intervallen, pathlen, x_{pos}, y_{pos}}$
		\State Solve optimization with initial states \textit{x0 u0 du0} for current \textit{horizon}
		\State $\textit{x0} \gets \text{ last } \textit{x} \text{ value in the interval}$
		\State $\textit{u0} \gets \text{ last } \textit{u} \text{ value in the interval}$
		\State $\textit{du0} \gets \text{ last } \textit{du} \text{ value in the interval}$
		\State Save results for \textit{interval}
	\EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

\begin{algorithm}
\caption{Generate horizon}
\label{alg:genHor}
\begin{algorithmic}
\Procedure{GenerateHorizon}{\textit{path timestep horizonlen pathlen $x_{pos}$ $y_{pos}$ speed}}
	\State $\textit{no timesteps} \gets \textit{horizonlen}/\textit{timestep}$
	\State $\textit{distance} \gets \textit{speed} * \textit{timestep}$
	\For{each \textit{no timesteps}}
		Find point on \textit{path} with the given \textit{distance} away from current \textit{$x_{pos}$} and \textit{$y_{pos}$}
	\EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}